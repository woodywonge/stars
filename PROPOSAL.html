<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Scalable, spatiotemporal Tidy Arrays for R • stars</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>



<meta property="og:title" content="Scalable, spatiotemporal Tidy Arrays for R" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">stars</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="articles/blog1.html">spatiotemporal arrays for R: stars blog one</a>
    </li>
    <li>
      <a href="articles/data_model.html">stars: data model</a>
    </li>
    <li>
      <a href="articles/first.html">spatiotemporal tidy arrays for R; first steps</a>
    </li>
    <li>
      <a href="articles/proxy.html">stars proxy objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-spatial/stars/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Scalable, spatiotemporal Tidy Arrays for R</h1>
    </div>

<div id="scalable-spatiotemporal-tidy-arrays-for-r" class="section level1">

<p><a href="https://github.com/edzer/">Edzer Pebesma</a>, <a href="https://github.com/mdsumner/">Michael Sumner</a>, <a href="https://github.com/etiennebr">Etienne Racine</a></p>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>A lot of spatiotemporal data takes the form of dense, multidimensional arrays. Examples are</p>
<ul>
<li>population counts by region, year and age group</li>
<li>weather data by variable, time step and sensor location</li>
<li>satellite imagery, e.g. energy by spectral band, location (pixel) and time of collection</li>
<li>climate model data, e.g. surface temperature by location, time and climate scenario.</li>
<li>financial data, e.g. share price by company and time</li>
</ul>
<p>Although such data <em>can</em> be represented in long tables, for larger datasets the array form is beneficial because it does not replicate dimension indexes, and the array form provides faster access by being implicitly indexed. R’s native arrays have a number of limitations, they</p>
<ul>
<li>cannot handle heterogeneous data records (e.g. consisting of a <code>numeric</code>, a <code>logical</code> and a <code>Date</code>) like we typically have in data.frame’s,</li>
<li>can only deal with in-memory data, and</li>
<li>do not handle spatial or temporal array dimensions.</li>
</ul>
<p>This project will (i) implement a flexible and generic multidimensional array model for heterogeneous records that (ii) handles strong spatial and temporal referencing of array indexes, and (iii) scales from moderately sized <em>in- memory</em> data, to large <em>on-disk</em> data, and to massive data held on remote servers, while using a unified user interface that follows the <a href="https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html">tidy tools manifesto</a>.</p>
</div>
<div id="the-problem" class="section level2">
<h2 class="hasAnchor">
<a href="#the-problem" class="anchor"></a>The Problem</h2>
<p>How do we handle and analyze large amounts of spatially referenced time series data in R? How do we handle satellite imagery that don’t fit on a local disc with R, or for which we need a small cluster to finish computation within acceptable time? How can we quickly and easily develop an analysis by testing it on a small portion of the spatiotemporal datasets, before deploying it on the massive data set? How can we use pipe-based workflows or dplyr-verbs on such data sets? How can we visualy explore high-dimensional raster data?</p>
<p>Today, people use R for large spatiotemporal data, but hit limits related to usability, user interface, and scalability. The <a href="https://stat.ethz.ch/pipermail/r-sig-geo/">r-sig-geo</a> mailing list documents many of these cases.</p>
<p>Now that the <a href="https://github.com/edzer/sfr">simple features for R</a> project has largely modernized the handling and analysis vector data (points, lines, polygons) in R in a tidyverse-friendly fashion, it is time for raster data to catch up. This proposal aims at spatiotemporal raster data, as well as time series of feature data.</p>
<div id="existing-work" class="section level3">
<h3 class="hasAnchor">
<a href="#existing-work" class="anchor"></a>Existing work</h3>
<p>Base R supports n-dimensional homogeneous arrays of basic types (double, integer, logical, logical), in-memory. Package <a href="https://CRAN.R-project.org/package=ff">ff</a> supports out-of-memory data structures, held on local disc, but no spatial or temporal references on dimensions.</p>
<p>Spatial packages include <a href="https://CRAN.R-project.org/package=rgdal">rgdal</a>, which lets you read and write raster data, possibly piece-by-piece, in one of 142 different file formats. Package <a href="https://CRAN.R-project.org/package=raster">raster</a> allows users to work with raster maps or stacks of them, where a stack can either refer to different bands (color) or different time steps, but not both. Package raster can iterate functions over large files on disc, and takes care of the caching, using either rgdal or <a href="https://CRAN.R-project.org/package=ncdf4">ncdf4</a>. Another package for reading and writing NetCDF is <a href="https://cran.r-project.org/package=RNetCDF">RNetCDF</a>. Packages that are more dedicated to a single data source or type include include <a href="https://CRAN.R-project.org/package=RStoolbox">RStoolbox</a>, <a href="https://CRAN.R-project.org/package=MODIS">MODIS</a>, <a href="https://CRAN.R-project.org/package=landsat">landsat</a>, and <a href="https://CRAN.R-project.org/package=hsdar">hsdar</a>; each of these relies on raster or rgdal for file-based I/O.</p>
<p>CRAN package <a href="https://CRAN.R-project.org/package=spacetime">spacetime</a> provides heterogeneous records, using a <code>data.frame</code> for attributes. It keeps indexes for each record to a spatial geometry (grid cell/point/polygon) and time instance or period; it keeps all data in memory and builds on <a href="https://CRAN.R-project.org/package=xts">xts</a> for temporal, and <a href="https://CRAN.R-project.org/package=sp">sp</a> for spatial reference.</p>
<p>With support from the R Consortium, the <a href="https://wiki.r-consortium.org/view/Distributed_Computing_Working_Group">Distributed Computing Working Group</a> has started to develop an API for distributed computing; an initial version is available in package <a href="https://github.com/vertica/ddR">ddR</a>. It aims at generic R data structures, and works towards relieving users from worrying that data is distributed.</p>
<p>Relevant work outside R includes</p>
<ul>
<li>
<a href="http://www.gdal.org/">GDAL</a>, in particular gdal <a href="http://www.gdal.org/gdalbuildvrt.html">virtual tiles</a> for building arbitrary large grid data sets from many individual files,</li>
<li>
<a href="http://www.paradigm4.com/">SciDB</a>, an open source array database which has no spatial or temporal capabilities, but a strongly scalable architecture, and extremely flexible array manipulation methods</li>
<li>
<a href="https://github.com/appelmar/scidb4geo">SciDB4geo</a>, a SciDB Plugin for Managing Spatial and Temporal Reference Information of Arrays, and <a href="https://github.com/appelmar/scidb4geo">SciDB4gdal</a>, a GDAL driver for SciDB arrays, two activities to make SciDB databases aware of space and time</li>
<li>
<a href="http://postgis.net/docs/RT_reference.html">PostGIS Raster</a>, a raster data extension of <a href="http://www.postgis.net/">PostGIS</a>
</li>
<li>
<a href="http://www.rasdaman.com/">Rasdaman</a>, an array database dedicate to images, which is partially open source.</li>
</ul>
<p>Since there is a definite trend that <a href="http://r-spatial.org/2016/11/29/openeo.html">downloading Earth observation data is no longer feasible</a>, we will have to work towards solutions where the data are accessed over a web service interface. Cloud services such as AWS are starting to give access to the large remote sensing imagery archives of e.g. <a href="https://aws.amazon.com/blogs/aws/start-using-landsat-on-aws/">Landsat</a>, <a href="https://aws.amazon.com/public-datasets/modis/">MODIS</a> and <a href="http://sentinel-pds.s3-website.eu-central-1.amazonaws.com/">Sentinel</a> satellites.</p>
</div>
</div>
<div id="the-plan" class="section level2">
<h2 class="hasAnchor">
<a href="#the-plan" class="anchor"></a>The Plan:</h2>
<p>We will develop an R package and container infrastructure that</p>
<ul>
<li>supports dense, n-dimensional arrays with heterogeneous records,</li>
<li>supports flexible reference from array dimensions to space, where space can be gridded (2D/3D raster) or a set of simple features (1D, irregular)</li>
<li>supports flexible reference from array dimensions to time (<code>POSIXct</code>, <code>Date</code>)</li>
<li>supports regular arrays (fixed cell size / time step) as well as irregular arrays</li>
<li>allows working in memory, on local disc, and on a remote computer (using a web service interface),</li>
<li>allows R functions to be passed on to the web service back-end, and executed there in parallel,</li>
<li>uses in-memory proxies to large arrays, allowing to work with the first <em>n</em> records before computations are carried out on the full arrays (similar to how dplyr does this)</li>
<li>allows pipe-based workflows, using <code>data.frame</code>s, and dplyr-style verbs.</li>
</ul>
<p>We will document the software and provide tutorials and reproducible data analysis examples using locally downloaded imagery, as well as scalable examples accessing larger (&gt; 1 Tb) datasets using docker container images.</p>
<p>We will document the RESTful API that connects the R client with the web service holding (and processing) the big Earth observation data.</p>
<p>We will also develop and discuss a migration path for the raster package (which has 43K lines of R, C and C++ code), and its functionality, into the new infrastructure.</p>
<p>We will publish the resulting products in an open access form, in the R journal, but also in a journal (or on a conference) more directed to the Earth observation community.</p>
<p>Timeline:</p>
<ul>
<li>Month 1-2: work out design, decide web service technology, basic web service API design</li>
<li>Month 3-6: programming the R package, testing with smaller data sets</li>
<li>Month 7-8: testing on larger datasets, develop test cases, deploy on docker containers</li>
<li>Month 9-12: write tutorials, develop teaching material and reproducible examples</li>
<li>Month 9-12: experiment with different back-ends: file-based, or database such as SciDB</li>
</ul>
<p>Failure modes:</p>
<ul>
<li>we can’t get the RESTful API to work properly; solution path: ask the rOpenSci community for help (Scott Chamberlain, Jeroen Ooms)</li>
<li>downloading large image sets is too cumbersome (slow) for the larger tutorial examples; solution path: deploy a test server for teaching/experimenting purposes in the Amazon cloud, where Landsat and Sentinel imagery is readily available</li>
</ul>
</div>
<div id="how-can-the-isc-help" class="section level2">
<h2 class="hasAnchor">
<a href="#how-can-the-isc-help" class="anchor"></a>How Can The ISC Help:</h2>
<p>We will use most funding to develop the R package and web service API. Total costs will be 10,000 USD, and breaks down in:</p>
<ul>
<li>workshop: travel costs for Etienne Racine and Michael Sumner to visit Muenster, or another venue where we can all meet (USD 2500).</li>
<li>Programming, project communication: (USD 7000).</li>
<li>Cloud deployment in the Amazon cloud (USD 500).</li>
</ul>
</div>
<div id="dissemination" class="section level2">
<h2 class="hasAnchor">
<a href="#dissemination" class="anchor"></a>Dissemination:</h2>
<p>We will regularly post blogs about the project on <a href="http://r-spatial.org/">r-spatial.org</a>, use twitter, post to <a href="https://stat.ethz.ch/mailman/listinfo/r-sig-geo">r-sig-geo</a>, stackoverflow, and communicate through github issues or gitter discussion. The project will live on GitHub, in the <a href="https://github.com/r-spatial/">r-spatial</a> organisation. We will work under a permissive open source license, probably LGPL-2.1. Pull requests will be encouraged. R consortium blogs will be provided at start and end. Publications in <em>the R Journal</em> and other scientific outlets are foreseen.</p>
</div>
</div>

  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by Edzer Pebesma.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

