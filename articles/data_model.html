<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>stars: data model • stars</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="stars: data model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stars</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/blog1.html">spatiotemporal arrays for R: stars blog one</a>
    </li>
    <li>
      <a href="../articles/data_model.html">stars: data model</a>
    </li>
    <li>
      <a href="../articles/first.html">spatiotemporal tidy arrays for R; first steps</a>
    </li>
    <li>
      <a href="../articles/proxy.html">stars proxy objects</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-spatial/stars/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>stars: data model</h1>
                        <h4 class="author">Edzer Pebesma</h4>
            
            <h4 class="date">September 28, 2018</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/stars//blob/master/vignettes/data_model.Rmd"><code>vignettes/data_model.Rmd</code></a></small>
      <div class="hidden name"><code>data_model.Rmd</code></div>

    </div>

    
    
<p>This vignette explains the data model of <code>stars</code> objects, illustrated using artificial and real datasets.</p>
<div id="grid-type" class="section level2">
<h2 class="hasAnchor">
<a href="#grid-type" class="anchor"></a>Grid type</h2>
<div id="regular-grids" class="section level3">
<h3 class="hasAnchor">
<a href="#regular-grids" class="anchor"></a>Regular grids</h3>
<p>With a very simple file created from a <span class="math inline">\(4 \times 5\)</span> matrix</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(stars))</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">m =<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">nrow =</span> <span class="dv">5</span>, <span class="dt">ncol =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">dim</span>(m) =<span class="st"> </span><span class="kw">c</span>(<span class="dt">x =</span> <span class="dv">5</span>, <span class="dt">y =</span> <span class="dv">4</span>) <span class="co"># named dim</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">(<span class="dt">s =</span> <span class="kw"><a href="../reference/st_as_stars.html">st_as_stars</a></span>(m))</a>
<a class="sourceLine" id="cb1-5" data-line-number="5">## stars object with 2 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">## attribute(s):</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">##       A1        </a>
<a class="sourceLine" id="cb1-8" data-line-number="8">##  Min.   : 1.00  </a>
<a class="sourceLine" id="cb1-9" data-line-number="9">##  1st Qu.: 5.75  </a>
<a class="sourceLine" id="cb1-10" data-line-number="10">##  Median :10.50  </a>
<a class="sourceLine" id="cb1-11" data-line-number="11">##  Mean   :10.50  </a>
<a class="sourceLine" id="cb1-12" data-line-number="12">##  3rd Qu.:15.25  </a>
<a class="sourceLine" id="cb1-13" data-line-number="13">##  Max.   :20.00  </a>
<a class="sourceLine" id="cb1-14" data-line-number="14">## dimension(s):</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">##   from to offset delta refsys point values    </a>
<a class="sourceLine" id="cb1-16" data-line-number="16">## x    1  5      0     1     NA    NA   NULL [x]</a>
<a class="sourceLine" id="cb1-17" data-line-number="17">## y    1  4      0     1     NA    NA   NULL [y]</a></code></pre></div>
<p>we see that</p>
<ul>
<li>the rows (5) are mapped to the first dimension, the x-coordinate</li>
<li>the columns (4) are mapped to the second dimension, the y-coordinate</li>
<li>the <code>from</code> and <code>to</code> fields of each dimension define a range that corresponds to the array dimension:</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">dim</span>(s[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">## x y </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">## 5 4</a></code></pre></div>
<ul>
<li>offset and delta specify how increasing row and column index maps to x and y coordinate values respectively.</li>
</ul>
<p>When we plot this object, using the <code>image</code> method for <code>stars</code> objects,</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">image</span>(s, <span class="dt">text_values =</span> <span class="ot">TRUE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-3-1.png" width="432"></p>
<p>we see that <span class="math inline">\((0,0)\)</span> is the origin of the grid (grid corner), and <span class="math inline">\(1\)</span> the coordinate value increase from one index (row, col) to the next. It means that consecutive matrix columns represent grid lines, going from south to north. Grids defined this way are <strong>regular</strong>: grid cell size is constant everywhere.</p>
<p>Many actual grid datasets have y coordinates (grid rows) going from North to South (top to bottom); this is realised with a negative value for <code>delta</code>. We see that the grid origing <span class="math inline">\((0,0)\)</span> did not change:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">attr</span>(s, <span class="st">"dimensions"</span>)[[<span class="dv">2</span>]]<span class="op">$</span>delta =<span class="st"> </span><span class="dv">-1</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw">image</span>(s, <span class="dt">text_values =</span> <span class="ot">TRUE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-4-1.png" width="432"></p>
<p>An example is the GeoTIFF carried in the package, which, as probably all data sources read through GDAL, has a negative <code>delta</code> for the <code>y</code>-coordinate:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">tif =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"tif/L7_ETMs.tif"</span>, <span class="dt">package =</span> <span class="st">"stars"</span>)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw"><a href="../reference/st_dimensions.html">st_dimensions</a></span>(<span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(tif))[<span class="st">"y"</span>]</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">##   from  to  offset delta                       refsys point values</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">## y    1 352 9120761 -28.5 +proj=utm +zone=25 +south... FALSE   NULL</a></code></pre></div>
</div>
<div id="raster-attributes-rotated-and-sheared-grids" class="section level3">
<h3 class="hasAnchor">
<a href="#raster-attributes-rotated-and-sheared-grids" class="anchor"></a>Raster attributes, rotated and sheared grids</h3>
<p>Dimension tables of <code>stars</code> objects carry a <code>raster</code> attribute:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">attr</span>(<span class="kw"><a href="../reference/st_dimensions.html">st_dimensions</a></span>(s), <span class="st">"raster"</span>))</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">## List of 3</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">##  $ affine     : num [1:2] 0 0</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">##  $ dimensions : chr [1:2] "x" "y"</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">##  $ curvilinear: logi FALSE</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">##  - attr(*, "class")= chr "stars_raster"</a></code></pre></div>
<p>which is a list that holds</p>
<ul>
<li>
<code>dimensions</code>: character, the names of raster dimensions (if any), as opposed to e.g. spectral, temporal or other dimensions</li>
<li>
<code>affine</code>: numeric, the affine parameters</li>
<li>
<code>curvilinear</code>: a logical indicating whether the raster is curvilinear</li>
</ul>
<p>These fields are needed at this level, because they describe properties of the array at a higher level than individual dimensions do: a pair of dimensions forms a raster, both <code>affine</code> and <code>curvilinear</code> describe how x and y <em>as a pair</em> are derived from grid indexes (see below) when this cannot be done on a per-dimension basis.</p>
<p>With two affine parameters <span class="math inline">\(a_1\)</span> and <span class="math inline">\(a_2\)</span>, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> coordinates are derived from (1-based) grid indexes <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, grid offset values <span class="math inline">\(o_x\)</span> and <span class="math inline">\(o_y\)</span>, and grid cell sizes <span class="math inline">\(d_x\)</span> and <span class="math inline">\(d_y\)</span> by</p>
<p><span class="math display">\[x = o_x + (i-1) d_x + (j-1) a_1\]</span></p>
<p><span class="math display">\[y = o_y + (i-1) a_2 + (j-1) d_y\]</span> Clearly, when <span class="math inline">\(a_1=a_2=0\)</span>, <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> are entirely derived from their respective index, offset and cellsize.</p>
<p>Note that for integer indexes, the coordinates are that of the starting edge of a grid cell; to get the grid cell center of the top left grid cell (in case of a negative <span class="math inline">\(d_y\)</span>), use <span class="math inline">\(i=1.5\)</span> and <span class="math inline">\(j=1.5\)</span>.</p>
<p>We can rotate grids by setting <span class="math inline">\(a_1\)</span> and <span class="math inline">\(a_2\)</span> to a non-zero value:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">attr</span>(<span class="kw">attr</span>(s, <span class="st">"dimensions"</span>), <span class="st">"raster"</span>)<span class="op">$</span>affine =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">plot</span>(<span class="kw"><a href="../reference/st_as_sf.html">st_as_sf</a></span>(s, <span class="dt">as_points =</span> <span class="ot">FALSE</span>), <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">nbreaks =</span> <span class="dv">20</span>)</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>The rotation angle, in degrees, is</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">atan2</span>(<span class="fl">0.1</span>, <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">180</span> <span class="op">/</span><span class="st"> </span>pi</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">## [1] 5.710593</a></code></pre></div>
</div>
<div id="regular-grids-sheared-sheared-and-rotated" class="section level3">
<h3 class="hasAnchor">
<a href="#regular-grids-sheared-sheared-and-rotated" class="anchor"></a>Regular grids: sheared, sheared and rotated</h3>
<p>Sheared grids are obtained when the two rotation coefficients, <span class="math inline">\(a_1\)</span> and <span class="math inline">\(a_2\)</span>, are unequal:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">attr</span>(<span class="kw">attr</span>(s, <span class="st">"dimensions"</span>), <span class="st">"raster"</span>)<span class="op">$</span>affine =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="kw">plot</span>(<span class="kw"><a href="../reference/st_as_sf.html">st_as_sf</a></span>(s, <span class="dt">as_points =</span> <span class="ot">FALSE</span>), <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">nbreaks =</span> <span class="dv">20</span>)</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>Now, the y-axis and x-axis have different rotation in degrees of respectively</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">atan2</span>(<span class="kw">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>), <span class="dv">1</span>) <span class="op">*</span><span class="st"> </span><span class="dv">180</span> <span class="op">/</span><span class="st"> </span>pi</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">## [1]  5.710593 11.309932</a></code></pre></div>
</div>
</div>
<div id="rectilinear-grids" class="section level2">
<h2 class="hasAnchor">
<a href="#rectilinear-grids" class="anchor"></a>Rectilinear grids</h2>
<p><a href="https://en.wikipedia.org/wiki/Regular_grid">Rectilinear grids</a> have orthogonal axes, but do not have congruent (equally sized and shaped) cells: each axes has its own irregular subdivision.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">x =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">y =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="fl">2.2</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">r =<span class="st"> </span><span class="kw"><a href="../reference/st_as_stars.html">st_as_stars</a></span>(<span class="kw">list</span>(<span class="dt">m =</span> m), <span class="dt">dimensions =</span> <span class="kw"><a href="../reference/st_dimensions.html">st_dimensions</a></span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y))</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">r</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">## stars object with 2 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">## attribute(s):</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">##        m        </a>
<a class="sourceLine" id="cb11-8" data-line-number="8">##  Min.   : 1.00  </a>
<a class="sourceLine" id="cb11-9" data-line-number="9">##  1st Qu.: 5.75  </a>
<a class="sourceLine" id="cb11-10" data-line-number="10">##  Median :10.50  </a>
<a class="sourceLine" id="cb11-11" data-line-number="11">##  Mean   :10.50  </a>
<a class="sourceLine" id="cb11-12" data-line-number="12">##  3rd Qu.:15.25  </a>
<a class="sourceLine" id="cb11-13" data-line-number="13">##  Max.   :20.00  </a>
<a class="sourceLine" id="cb11-14" data-line-number="14">## dimension(s):</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">##   from to offset delta refsys point        values</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">## x    1  6     NA    NA     NA    NA     0, ..., 5</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">## y    1  5     NA    NA     NA    NA 0.3, ..., 2.2</a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#plot(st_as_sf(r, as_points = FALSE), axes = TRUE, nbreaks = 20)</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="kw">image</span>(x, y, m, <span class="dt">col =</span> <span class="kw">sf.colors</span>(<span class="dv">21</span>))</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">x1 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.25</span>,<span class="fl">0.75</span>,<span class="fl">1.5</span>,<span class="dv">3</span>,<span class="fl">4.5</span>)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">y1 =<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.4</span>,<span class="fl">0.75</span>,<span class="fl">1.5</span>,<span class="fl">2.1</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="kw">image</span>(x1, y1, m, <span class="dt">col =</span> <span class="kw">sf.colors</span>(<span class="dv">21</span>))</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-11-2.png" width="700"></p>
</div>
<div id="curvilinear-grids" class="section level2">
<h2 class="hasAnchor">
<a href="#curvilinear-grids" class="anchor"></a>Curvilinear grids</h2>
<p>Curvilinear grids are grids whose grid lines are not straight. Rather than describing the curvature parametrically, the typical (HDF5 or netcdf) files in which they are found have two raster layers, one with the latitudes and one with the longitudes for every grid cell. Using the GDAL interface, we need to compose a <code>stars</code> object from the array and a long and lat matrix. The matrices with longitude and latitude values are stored in the <code>values</code> field of their respective dimensions.</p>
<p>As an example, we will use a Sentinel 5P dataset available from package <code>starsdata</code>; this package can be installed with</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">"starsdata"</span>, <span class="dt">repos =</span> <span class="st">"http://pebesma.staff.ifgi.de"</span>, <span class="dt">type =</span> <span class="st">"source"</span>) </a></code></pre></div>
<p>The dataset is found here:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">(<span class="dt">s5p =</span> <span class="kw">system.file</span>(<span class="st">"sentinel5p/S5P_NRTI_L2__NO2____20180717T120113_20180717T120613_03932_01_010002_20180717T125231.nc"</span>, <span class="dt">package =</span> <span class="st">"starsdata"</span>))</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">## [1] "/home/travis/R/Library/starsdata/sentinel5p/S5P_NRTI_L2__NO2____20180717T120113_20180717T120613_03932_01_010002_20180717T125231.nc"</a></code></pre></div>
<p>We can construct the curvilinear <code>stars</code> raster by calling <code>st_as_stars</code> on three arrays, with data, longitude and latitudes:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">lat_ds =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"HDF5:</span><span class="ch">\"</span><span class="st">"</span>, s5p, <span class="st">"</span><span class="ch">\"</span><span class="st">://PRODUCT/latitude"</span>)</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">lon_ds =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"HDF5:</span><span class="ch">\"</span><span class="st">"</span>, s5p, <span class="st">"</span><span class="ch">\"</span><span class="st">://PRODUCT/longitude"</span>)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">nit_ds =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">"HDF5:</span><span class="ch">\"</span><span class="st">"</span>, s5p, <span class="st">"</span><span class="ch">\"</span><span class="st">://PRODUCT/SUPPORT_DATA/DETAILED_RESULTS/nitrogendioxide_summed_total_column"</span>)</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">lat =<span class="st"> </span><span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(lat_ds)</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">## Warning in get_raster(affine = pr$geotransform[c(3, 5)], dimensions =</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">## c("x", : setting NA affine values to zero</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">lon =<span class="st"> </span><span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(lon_ds)</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">## Warning in get_raster(affine = pr$geotransform[c(3, 5)], dimensions =</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">## c("x", : setting NA affine values to zero</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">nit =<span class="st"> </span><span class="kw"><a href="../reference/read_stars.html">read_stars</a></span>(nit_ds)</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">## Warning in get_raster(affine = pr$geotransform[c(3, 5)], dimensions =</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">## c("x", : setting NA affine values to zero</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">nit[[<span class="dv">1</span>]][nit[[<span class="dv">1</span>]] <span class="op">&gt;</span><span class="st"> </span><span class="fl">9e+36</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"></a>
<a class="sourceLine" id="cb15-15" data-line-number="15">ll =<span class="st"> </span><span class="kw">setNames</span>(<span class="kw">c</span>(lon, lat), <span class="kw">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>))</a>
<a class="sourceLine" id="cb15-16" data-line-number="16">nit.c =<span class="st"> </span><span class="kw"><a href="../reference/st_as_stars.html">st_as_stars</a></span>(nit, <span class="dt">curvilinear =</span> ll)</a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="kw">st_crs</span>(nit.c) =<span class="st"> </span><span class="dv">4326</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18">nit.c</a>
<a class="sourceLine" id="cb15-19" data-line-number="19">## stars object with 2 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb15-20" data-line-number="20">## attribute(s):</a>
<a class="sourceLine" id="cb15-21" data-line-number="21">##  nitrogendioxide_summed_total_column </a>
<a class="sourceLine" id="cb15-22" data-line-number="22">##  Min.   :0e+00                       </a>
<a class="sourceLine" id="cb15-23" data-line-number="23">##  1st Qu.:1e-04                       </a>
<a class="sourceLine" id="cb15-24" data-line-number="24">##  Median :1e-04                       </a>
<a class="sourceLine" id="cb15-25" data-line-number="25">##  Mean   :1e-04                       </a>
<a class="sourceLine" id="cb15-26" data-line-number="26">##  3rd Qu.:1e-04                       </a>
<a class="sourceLine" id="cb15-27" data-line-number="27">##  Max.   :5e-04                       </a>
<a class="sourceLine" id="cb15-28" data-line-number="28">##  NA's   :330                         </a>
<a class="sourceLine" id="cb15-29" data-line-number="29">## dimension(s):</a>
<a class="sourceLine" id="cb15-30" data-line-number="30">##   from  to offset delta                       refsys point</a>
<a class="sourceLine" id="cb15-31" data-line-number="31">## x    1 450     NA    NA +proj=longlat +datum=WGS8...    NA</a>
<a class="sourceLine" id="cb15-32" data-line-number="32">## y    1 278     NA    NA +proj=longlat +datum=WGS8...    NA</a>
<a class="sourceLine" id="cb15-33" data-line-number="33">##                             values    </a>
<a class="sourceLine" id="cb15-34" data-line-number="34">## x [450x278] -5.81066, ..., 30.9468 [x]</a>
<a class="sourceLine" id="cb15-35" data-line-number="35">## y  [450x278] 28.3605, ..., 51.4686 [y]</a>
<a class="sourceLine" id="cb15-36" data-line-number="36">## curvilinear grid</a></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">plot</span>(nit.c, <span class="dt">breaks =</span> <span class="st">"equal"</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">as_points =</span> <span class="ot">TRUE</span>, <span class="dt">pch =</span> <span class="dv">16</span>, <span class="dt">key.pos =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">maps<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/maps/topics/map">map</a></span>(<span class="st">'world'</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">'red'</span>)</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">plot</span>(nit.c, <span class="dt">breaks =</span> <span class="st">"equal"</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">as_points =</span> <span class="ot">FALSE</span>, <span class="dt">border =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">maps<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/maps/topics/map">map</a></span>(<span class="st">'world'</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">'red'</span>)</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>We can downsample the data by</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">(<span class="dt">nit.c =</span> stars<span class="op">:::</span><span class="kw">st_downsample</span>(nit.c, <span class="dv">8</span>))</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">## stars object with 2 dimensions and 1 attribute</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">## attribute(s):</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">##  nitrogendioxide_summed_total_column </a>
<a class="sourceLine" id="cb18-5" data-line-number="5">##  Min.   :0.00005                     </a>
<a class="sourceLine" id="cb18-6" data-line-number="6">##  1st Qu.:0.00007                     </a>
<a class="sourceLine" id="cb18-7" data-line-number="7">##  Median :0.00008                     </a>
<a class="sourceLine" id="cb18-8" data-line-number="8">##  Mean   :0.00009                     </a>
<a class="sourceLine" id="cb18-9" data-line-number="9">##  3rd Qu.:0.00009                     </a>
<a class="sourceLine" id="cb18-10" data-line-number="10">##  Max.   :0.00023                     </a>
<a class="sourceLine" id="cb18-11" data-line-number="11">##  NA's   :36                          </a>
<a class="sourceLine" id="cb18-12" data-line-number="12">## dimension(s):</a>
<a class="sourceLine" id="cb18-13" data-line-number="13">##   from to offset delta                       refsys point</a>
<a class="sourceLine" id="cb18-14" data-line-number="14">## x    1 57     NA    NA +proj=longlat +datum=WGS8...    NA</a>
<a class="sourceLine" id="cb18-15" data-line-number="15">## y    1 35     NA    NA +proj=longlat +datum=WGS8...    NA</a>
<a class="sourceLine" id="cb18-16" data-line-number="16">##                           values    </a>
<a class="sourceLine" id="cb18-17" data-line-number="17">## x [57x35] -5.59621, ..., 30.8488 [x]</a>
<a class="sourceLine" id="cb18-18" data-line-number="18">## y  [57x35] 28.3605, ..., 51.1544 [y]</a>
<a class="sourceLine" id="cb18-19" data-line-number="19">## curvilinear grid</a>
<a class="sourceLine" id="cb18-20" data-line-number="20"><span class="kw">plot</span>(nit.c, <span class="dt">breaks =</span> <span class="st">"equal"</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">as_points =</span> <span class="ot">TRUE</span>, <span class="dt">pch =</span> <span class="dv">16</span>)</a>
<a class="sourceLine" id="cb18-21" data-line-number="21">maps<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/maps/topics/map">map</a></span>(<span class="st">'world'</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">'red'</span>)</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>which doesn’t look nice, but plotting the cells as polygons looks better:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">plot</span>(nit.c, <span class="dt">breaks =</span> <span class="st">"equal"</span>, <span class="dt">reset =</span> <span class="ot">FALSE</span>, <span class="dt">axes =</span> <span class="ot">TRUE</span>, <span class="dt">as_points =</span> <span class="ot">FALSE</span>, <span class="dt">border =</span> <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb19-2" data-line-number="2">maps<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/maps/topics/map">map</a></span>(<span class="st">'world'</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">'red'</span>)</a></code></pre></div>
<p><img src="data_model_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#grid-type">Grid type</a></li>
      <li><a href="#rectilinear-grids">Rectilinear grids</a></li>
      <li><a href="#curvilinear-grids">Curvilinear grids</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Edzer Pebesma.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
